# TASK-002: 認証システム UI

## タスク情報

- **タスク ID**: TASK-002
- **タスク名**: 認証システム UI
- **カテゴリ**: auth
- **担当エージェント**: Agent-2
- **優先度**: 高
- **状態**: pending
- **作成日**: 2024-12-19
- **予想工数**: 8 時間

## 概要

SaaS アカウント一元管理システムの認証システム UI を実装する。OAuth2.0/SAML2.0 に対応し、セキュアで使いやすい認証フローを構築する。

## 技術要件

- **認証**: NextAuth.js v4
- **OAuth プロバイダー**: Google, Microsoft, GitHub
- **セキュリティ**: JWT, CSRF 保護, セッション管理
- **UI**: shadcn/ui コンポーネント
- **フォーム**: React Hook Form + Zod

## 作業内容

### 1. 認証ページ

- [ ] ログインページ (/login)
- [ ] サインアップページ (/register)
- [ ] パスワードリセットページ (/forgot-password)
- [ ] パスワード変更ページ (/reset-password)
- [ ] ログアウト処理

### 2. OAuth 連携

- [ ] Google OAuth ログイン
- [ ] Microsoft OAuth ログイン
- [ ] GitHub OAuth ログイン
- [ ] OAuth コールバック処理
- [ ] エラーハンドリング

### 3. セキュリティ機能

- [ ] 多要素認証 (MFA)
- [ ] パスワード強度チェック
- [ ] アカウントロック機能
- [ ] セッション管理
- [ ] CSRF 保護

### 4. ユーザー体験

- [ ] ローディング状態
- [ ] エラーメッセージ表示
- [ ] 成功メッセージ表示
- [ ] リダイレクト処理
- [ ] レスポンシブデザイン

### 5. 認証ガード

- [ ] 認証状態チェック
- [ ] ページアクセス制御
- [ ] ロールベース認可
- [ ] 認証コンテキスト

## 対象ファイル

```
src/app/(auth)/
├── login/
│   └── page.tsx
├── register/
│   └── page.tsx
├── forgot-password/
│   └── page.tsx
├── reset-password/
│   └── page.tsx
├── callback/
│   └── page.tsx
└── layout.tsx

src/components/features/auth/
├── login-form.tsx
├── register-form.tsx
├── forgot-password-form.tsx
├── reset-password-form.tsx
├── oauth-buttons.tsx
├── mfa-setup.tsx
├── password-strength.tsx
└── auth-guard.tsx

src/lib/
├── auth.ts
├── auth-config.ts
└── auth-utils.ts

src/hooks/
├── use-auth.ts
└── use-session.ts
```

## 受け入れ基準

### 必須要件 (Must Have)

- [ ] ユーザーがログイン/ログアウトできる
- [ ] OAuth2.0 による認証が動作する
- [ ] セキュリティ要件を満たす
- [ ] エラーハンドリングが適切に実装されている
- [ ] レスポンシブデザインに対応している

### 推奨要件 (Should Have)

- [ ] 多要素認証が利用可能
- [ ] パスワード強度チェックが動作する
- [ ] セッション管理が適切に実装されている
- [ ] ユーザー体験が最適化されている

### 望ましい要件 (Could Have)

- [ ] ソーシャルログイン（追加プロバイダー）
- [ ] 生体認証対応
- [ ] シングルサインオン (SSO)
- [ ] 監査ログ記録

## 画面設計

### ログイン画面

```
┌─────────────────────────────────────────────────────────────┐
│                    SaaS アカウント管理                        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ログイン                                                     │
│                                                             │
│  メールアドレス: [________________]                           │
│  パスワード:     [________________]                           │
│                                                             │
│  [ ログイン ]  [ パスワードを忘れた場合 ]                       │
│                                                             │
│  ─────────────── または ───────────────                      │
│                                                             │
│  [ Google でログイン ]                                        │
│  [ Microsoft でログイン ]                                     │
│  [ GitHub でログイン ]                                        │
│                                                             │
│  アカウントをお持ちでない場合: [ 新規登録 ]                      │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 多要素認証画面

```
┌─────────────────────────────────────────────────────────────┐
│                    二要素認証                                │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  認証アプリから6桁のコードを入力してください                      │
│                                                             │
│  コード: [____] [____] [____]                               │
│                                                             │
│  [ 確認 ]  [ 戻る ]                                          │
│                                                             │
│  コードを受け取れない場合: [ 別の方法で認証 ]                    │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## セキュリティ仕様

### 認証フロー

1. ユーザーが認証情報を入力
2. サーバーサイドでバリデーション
3. 認証成功時に JWT トークン発行
4. セッション情報を Redis に保存
5. CSRF トークンの生成・検証

### パスワードポリシー

- 最小 8 文字以上
- 大文字・小文字・数字・記号を含む
- 過去 10 回のパスワード履歴をチェック
- 辞書攻撃対策

### セッション管理

- アクセストークン有効期限: 15 分
- リフレッシュトークン有効期限: 7 日
- セッション自動延長
- 同時セッション数制限

## 依存関係

- **前提条件**: TASK-001 (基本プロジェクト構造), TASK-008 (共通コンポーネント)
- **ブロッカー**: なし
- **次のタスク**: TASK-003, TASK-004, TASK-005, TASK-006, TASK-007

## 参考資料

- [NextAuth.js Documentation](https://next-auth.js.org/)
- [OAuth2.0 RFC](https://tools.ietf.org/html/rfc6749)
- [OWASP Authentication](https://owasp.org/www-project-cheat-sheets/cheatsheets/Authentication_Cheat_Sheet.html)
- docs/DSG-001\_基本設計書.md
- docs/IMP-001\_実装ガイドライン.md

## 実装ログ

### 2024-12-19

- タスク作成完了
- 要件定義完了
- セキュリティ仕様設計完了

## 完了条件

1. 全ての認証フローが正常に動作する
2. OAuth2.0 認証が設定されている
3. セキュリティテストに合格する
4. TypeScript の型エラーがない
5. 認証ガードが適切に機能する
