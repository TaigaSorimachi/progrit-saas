# TASK-004: ユーザー管理 UI

## タスク情報

- **タスク ID**: TASK-004
- **タスク名**: ユーザー管理 UI
- **カテゴリ**: users
- **担当エージェント**: Agent-4
- **優先度**: 中
- **状態**: pending
- **作成日**: 2024-12-19
- **予想工数**: 8 時間

## 概要

SaaS アカウント一元管理システムのユーザー管理 UI を実装する。従業員情報の管理、一括操作、CSV インポート・エクスポート、SaaS アカウント連携状況を含む包括的なユーザー管理画面を構築する。

## 技術要件

- **データテーブル**: TanStack Table
- **フォーム**: React Hook Form + Zod
- **ファイル操作**: React Dropzone
- **状態管理**: TanStack Query
- **UI**: shadcn/ui コンポーネント

## 作業内容

### 1. ユーザー一覧画面

- [ ] データテーブル (ソート、フィルター、ページネーション)
- [ ] 検索・フィルター機能
- [ ] 一括選択・操作
- [ ] ユーザー状態表示
- [ ] SaaS 連携状況表示

### 2. ユーザー詳細画面

- [ ] 基本情報表示・編集
- [ ] 所属部署・役職管理
- [ ] SaaS アカウント一覧
- [ ] 権限設定
- [ ] 操作履歴

### 3. ユーザー作成・編集

- [ ] 新規ユーザー作成フォーム
- [ ] ユーザー情報編集フォーム
- [ ] バリデーション機能
- [ ] プレビュー機能
- [ ] 確認ダイアログ

### 4. 一括操作機能

- [ ] CSV インポート
- [ ] CSV エクスポート
- [ ] 一括権限変更
- [ ] 一括部署移動
- [ ] 一括削除

### 5. 高度な検索・フィルター

- [ ] 複数条件検索
- [ ] 保存済み検索
- [ ] 動的フィルター
- [ ] ソート機能

## 対象ファイル

```
src/app/(dashboard)/users/
├── page.tsx
├── [id]/
│   ├── page.tsx
│   └── edit/
│       └── page.tsx
├── new/
│   └── page.tsx
└── import/
    └── page.tsx

src/components/features/users/
├── user-table.tsx
├── user-card.tsx
├── user-form.tsx
├── user-detail.tsx
├── user-search.tsx
├── user-filters.tsx
├── user-actions.tsx
├── bulk-actions.tsx
├── csv-import.tsx
├── csv-export.tsx
├── user-permissions.tsx
├── saas-accounts.tsx
├── activity-history.tsx
├── user-status.tsx
└── user-avatar.tsx

src/hooks/
├── use-users.ts
├── use-user-form.ts
├── use-bulk-actions.ts
├── use-csv-import.ts
└── use-user-search.ts
```

## 受け入れ基準

### 必須要件 (Must Have)

- [ ] ユーザー一覧が正常に表示される
- [ ] ユーザーの作成・編集・削除ができる
- [ ] 検索・フィルター機能が動作する
- [ ] CSV インポート・エクスポートが動作する
- [ ] データ整合性が保たれている

### 推奨要件 (Should Have)

- [ ] 一括操作が正常に動作する
- [ ] SaaS 連携状況が表示される
- [ ] ユーザビリティが高い
- [ ] パフォーマンスが最適化されている

### 望ましい要件 (Could Have)

- [ ] 高度な検索機能
- [ ] カスタムフィールド対応
- [ ] データ可視化
- [ ] 操作ログの詳細表示

## 画面設計

### ユーザー一覧画面

```
┌─────────────────────────────────────────────────────────────────────┐
│ ユーザー管理                             [ 新規作成 ] [ CSVインポート ] │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│ 🔍 [検索ボックス___________] [部署▼] [状態▼] [SaaS▼] [ フィルタ ][🔄] │
│                                                                     │
│ ☑ 選択中: 3件  [ 一括削除 ] [ 部署変更 ] [ 権限変更 ] [ エクスポート ]  │
│                                                                     │
│ ┌─┬──────────┬──────┬──────┬──────────┬────────┬────────┐   │
│ │☑│   名前    │ 部署 │ 役職 │   メール   │ SaaS │ 状態  │   │
│ ├─┼──────────┼──────┼──────┼──────────┼────────┼────────┤   │
│ │☑│田中 太郎   │営業部 │主任 │tanaka@... │ 🟢 3/3 │アクティブ│   │
│ │☐│佐藤 花子   │人事部 │係長 │sato@...  │ 🟡 2/3 │アクティブ│   │
│ │☐│鈴木 一郎   │技術部 │部長 │suzuki@.. │ 🟢 3/3 │アクティブ│   │
│ │☐│山田 次郎   │営業部 │担当 │yamada@.. │ 🔴 0/3 │休職中  │   │
│ └─┴──────────┴──────┴──────┴──────────┴────────┴────────┘   │
│                                                                     │
│                    ◀ 前 | 1 2 3 4 5 | 次 ▶                        │
└─────────────────────────────────────────────────────────────────────┘
```

### ユーザー詳細画面

```
┌─────────────────────────────────────────────────────────────────────┐
│ ユーザー詳細: 田中 太郎                        [ 編集 ] [ 削除 ]       │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│ ┌─────────────────┐ ┌─────────────────────────────────────────────┐ │
│ │   [👤]          │ │ 基本情報                                     │ │
│ │ 田中 太郎         │ │ 社員番号: EMP001                            │ │
│ │ 営業部 主任       │ │ メール: tanaka@company.com                  │ │
│ │ tanaka@...      │ │ 入社日: 2020-04-01                          │ │
│ └─────────────────┘ │ 上司: 佐藤部長                               │ │
│                     │ 電話: 03-1234-5678                           │ │
│                     └─────────────────────────────────────────────┘ │
│                                                                     │
│ ┌─────────────────────────────────────────────────────────────────┐ │
│ │ SaaS アカウント                                                   │ │
│ │ ┌──────────┬──────────┬──────────┬──────────┐                  │ │
│ │ │ サービス  │ アカウント │   状態    │ 最終同期  │                  │ │
│ │ ├──────────┼──────────┼──────────┼──────────┤                  │ │
│ │ │ Google   │ tanaka@  │ アクティブ │ 5分前    │                  │ │
│ │ │ Slack    │ @tanaka  │ アクティブ │ 10分前   │                  │ │
│ │ │ GitHub   │ tanaka   │ 未連携    │ -        │                  │ │
│ │ └──────────┴──────────┴──────────┴──────────┘                  │ │
│ └─────────────────────────────────────────────────────────────────┘ │
│                                                                     │
│ ┌─────────────────────────────────────────────────────────────────┐ │
│ │ 最近の活動                                                        │ │
│ │ • 2024-12-19 09:30 - ログイン                                    │ │
│ │ • 2024-12-18 18:45 - Slack権限更新                               │ │
│ │ • 2024-12-18 14:20 - Google Workspace同期                       │ │
│ └─────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────┘
```

## データ仕様

### ユーザー情報

```typescript
interface User {
  id: string;
  employeeId: string;
  name: string;
  nameKana?: string;
  email: string;
  phone?: string;
  department: {
    id: string;
    name: string;
  };
  position?: string;
  manager?: {
    id: string;
    name: string;
  };
  hireDate: Date;
  terminationDate?: Date;
  status: "active" | "inactive" | "terminated";
  saasAccounts: SaaSAccount[];
  permissions: Permission[];
  createdAt: Date;
  updatedAt: Date;
}
```

### SaaS アカウント情報

```typescript
interface SaaSAccount {
  id: string;
  provider: string;
  accountId: string;
  email?: string;
  status: "active" | "suspended" | "deleted";
  permissions: string[];
  lastSync: Date;
  createdAt: Date;
}
```

## 機能詳細

### CSV インポート機能

- ファイル形式バリデーション
- データ形式チェック
- 重複チェック
- プレビュー機能
- エラーレポート

### 一括操作機能

- 複数ユーザー選択
- 部署一括変更
- 権限一括付与・削除
- ステータス一括変更
- 進行状況表示

### 検索・フィルター機能

- 名前・メール・社員番号検索
- 部署・役職フィルター
- SaaS 連携状況フィルター
- カスタム検索条件保存

## 依存関係

- **前提条件**: TASK-001 (基本プロジェクト構造), TASK-008 (共通コンポーネント), TASK-002 (認証システム)
- **ブロッカー**: なし
- **次のタスク**: TASK-005, TASK-006

## 参考資料

- [TanStack Table Documentation](https://tanstack.com/table/v8)
- [React Hook Form Documentation](https://react-hook-form.com/)
- [React Dropzone Documentation](https://react-dropzone.js.org/)
- docs/DSG-001\_基本設計書.md
- docs/REQ-001\_要求仕様書.md

## 実装ログ

### 2024-12-19

- タスク作成完了
- 要件定義完了
- 画面設計完了

## 完了条件

1. ユーザー一覧・詳細・作成・編集が正常に動作する
2. CSV インポート・エクスポート機能が動作する
3. 検索・フィルター機能が正常に動作する
4. 一括操作機能が実装されている
5. データ整合性とセキュリティが確保されている
