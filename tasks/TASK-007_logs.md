# TASK-007: レポート・ログ UI

## タスク情報

- **タスク ID**: TASK-007
- **タスク名**: レポート・ログ UI
- **カテゴリ**: logs
- **担当エージェント**: Agent-7
- **優先度**: 低
- **状態**: pending
- **作成日**: 2024-12-19
- **予想工数**: 8 時間

## 概要

SaaS アカウント一元管理システムのレポート・ログ UI を実装する。監査ログ、システムログ、アクセスログの表示・検索・分析機能、各種レポート生成、コンプライアンス対応を含む包括的な監視画面を構築する。

## 技術要件

- **データ可視化**: Recharts + D3.js
- **データテーブル**: TanStack Table
- **検索・フィルター**: Elasticsearch + React
- **エクスポート**: jsPDF + xlsx
- **UI**: shadcn/ui コンポーネント

## 作業内容

### 1. ログ管理

- [ ] 監査ログ表示
- [ ] システムログ表示
- [ ] アクセスログ表示
- [ ] エラーログ表示
- [ ] セキュリティログ表示

### 2. 検索・フィルター

- [ ] 高度な検索機能
- [ ] 日付範囲フィルター
- [ ] ユーザー・部署フィルター
- [ ] アクション種別フィルター
- [ ] 保存済み検索条件

### 3. レポート生成

- [ ] 利用状況レポート
- [ ] セキュリティレポート
- [ ] コンプライアンスレポート
- [ ] パフォーマンスレポート
- [ ] カスタムレポート

### 4. データ可視化

- [ ] 時系列グラフ
- [ ] アクティビティマップ
- [ ] 統計チャート
- [ ] ダッシュボード
- [ ] リアルタイム監視

### 5. エクスポート機能

- [ ] CSV エクスポート
- [ ] PDF レポート
- [ ] Excel ファイル
- [ ] JSON データ
- [ ] スケジュール出力

## 対象ファイル

```
src/app/(dashboard)/logs/
├── page.tsx
├── audit/
│   └── page.tsx
├── system/
│   └── page.tsx
├── access/
│   └── page.tsx
├── security/
│   └── page.tsx
└── reports/
    ├── page.tsx
    └── [type]/
        └── page.tsx

src/components/features/logs/
├── log-table.tsx
├── log-viewer.tsx
├── log-filters.tsx
├── log-search.tsx
├── log-export.tsx
├── audit-timeline.tsx
├── activity-chart.tsx
├── security-alerts.tsx
├── compliance-report.tsx
├── performance-metrics.tsx
├── report-generator.tsx
├── chart-dashboard.tsx
└── real-time-monitor.tsx

src/hooks/
├── use-logs.ts
├── use-log-search.ts
├── use-reports.ts
├── use-charts.ts
└── use-export.ts
```

## 受け入れ基準

### 必須要件 (Must Have)

- [ ] 各種ログが正常に表示される
- [ ] 検索・フィルター機能が動作する
- [ ] 基本的なレポート生成ができる
- [ ] CSV エクスポートが動作する
- [ ] データ整合性が保たれている

### 推奨要件 (Should Have)

- [ ] 高度な検索機能が実装されている
- [ ] データ可視化が正常に動作する
- [ ] 複数形式のエクスポートが可能
- [ ] パフォーマンスが最適化されている

### 望ましい要件 (Could Have)

- [ ] リアルタイム監視機能
- [ ] 高度な分析機能
- [ ] カスタムダッシュボード
- [ ] 自動レポート生成

## 画面設計

### 監査ログ画面

```
┌─────────────────────────────────────────────────────────────────────┐
│ 監査ログ                                        [ エクスポート ] [ 🔄 ] │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│ 🔍 [検索________________] [📅 日付] [👤 ユーザー] [🔧 アクション] [🔍]   │
│                                                                     │
│ 保存済み検索: [ 今日のログイン ] [ 権限変更 ] [ エラー ] [ カスタム▼ ]   │
│                                                                     │
│ ┌─┬──────────┬──────────┬──────────┬──────────┬──────────┐       │
│ │#│   時刻    │ユーザー   │ アクション │ 対象     │ 結果     │       │
│ ├─┼──────────┼──────────┼──────────┼──────────┼──────────┤       │
│ │1│2024-12-19│田中太郎   │ログイン   │システム  │成功      │       │
│ │ │09:30:15  │          │          │          │          │       │
│ │2│2024-12-19│佐藤花子   │権限変更   │山田一郎  │成功      │       │
│ │ │09:25:33  │          │          │          │          │       │
│ │3│2024-12-19│システム   │自動同期   │Slack     │失敗      │       │
│ │ │09:20:01  │          │          │          │          │       │
│ │4│2024-12-19│鈴木太郎   │アカウント │新規作成  │成功      │       │
│ │ │09:15:45  │          │作成       │          │          │       │
│ └─┴──────────┴──────────┴──────────┴──────────┴──────────┘       │
│                                                                     │
│                    ◀ 前 | 1 2 3 4 5 | 次 ▶                        │
└─────────────────────────────────────────────────────────────────────┘
```

### レポート生成画面

```
┌─────────────────────────────────────────────────────────────────────┐
│ レポート生成                                    [ 新規作成 ] [ 履歴 ] │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐       │
│ │  📊 利用状況     │ │  🔒 セキュリティ │ │  📋 コンプライアンス │       │
│ │  レポート       │ │  レポート       │ │  レポート       │       │
│ │                 │ │                 │ │                 │       │
│ │ • ユーザー活動   │ │ • ログイン試行   │ │ • 監査証跡      │       │
│ │ • SaaS利用統計  │ │ • 権限変更      │ │ • アクセス記録   │       │
│ │ • 部署別分析    │ │ • 異常検知      │ │ • 法規制対応    │       │
│ │                 │ │                 │ │                 │       │
│ │ [ 生成 ]        │ │ [ 生成 ]        │ │ [ 生成 ]        │       │
│ └─────────────────┘ └─────────────────┘ └─────────────────┘       │
│                                                                     │
│ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐       │
│ │  ⚡ パフォーマンス │ │  📈 カスタム     │ │  📅 定期レポート │       │
│ │  レポート       │ │  レポート       │ │  スケジュール    │       │
│ │                 │ │                 │ │                 │       │
│ │ • 応答時間分析   │ │ • 自由設計      │ │ • 毎日          │       │
│ │ • エラー率      │ │ • 任意のデータ   │ │ • 毎週          │       │
│ │ • 使用量監視    │ │ • カスタム条件   │ │ • 毎月          │       │
│ │                 │ │                 │ │                 │       │
│ │ [ 生成 ]        │ │ [ 作成 ]        │ │ [ 設定 ]        │       │
│ └─────────────────┘ └─────────────────┘ └─────────────────┘       │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### データ可視化ダッシュボード

```
┌─────────────────────────────────────────────────────────────────────┐
│ ログ分析ダッシュボード                          [ 設定 ] [ 全画面 ]    │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│ ┌─────────────────────────────┐ ┌─────────────────────────────┐   │
│ │      アクティビティ推移        │ │      アクション分布         │   │
│ │                             │ │                             │   │
│ │  50┌─────────────────────┐   │ │     ログイン: 45%           │   │
│ │     │       ╱╲            │   │ │     権限変更: 25%           │   │
│ │  30 │     ╱    ╲          │   │ │     アカウント作成: 20%      │   │
│ │     │   ╱        ╲        │   │ │     その他: 10%            │   │
│ │  10 │ ╱            ╲      │   │ │                             │   │
│ │     └─────────────────────┘   │ │                             │   │
│ │     09:00 12:00 15:00 18:00  │ │                             │   │
│ └─────────────────────────────┘ └─────────────────────────────┘   │
│                                                                     │
│ ┌─────────────────────────────┐ ┌─────────────────────────────┐   │
│ │      部署別アクティビティ      │ │      エラー発生状況         │   │
│ │                             │ │                             │   │
│ │ 営業部   ████████████ 45%   │ │ 今日のエラー: 3件           │   │
│ │ 技術部   ████████ 30%       │ │ 今週のエラー: 12件          │   │
│ │ 人事部   ████ 15%           │ │ 今月のエラー: 45件          │   │
│ │ 総務部   ██ 10%             │ │                             │   │
│ │                             │ │ 主な原因:                   │   │
│ │                             │ │ • API制限: 8件              │   │
│ │                             │ │ • 認証失敗: 4件             │   │
│ └─────────────────────────────┘ └─────────────────────────────┘   │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

## データ仕様

### 監査ログ

```typescript
interface AuditLog {
  id: string;
  timestamp: Date;
  userId: string;
  userName: string;
  userRole: string;
  action: string;
  target: string;
  targetType: "user" | "saas" | "system" | "workflow";
  result: "success" | "failure" | "warning";
  details: Record<string, any>;
  ipAddress: string;
  userAgent: string;
  sessionId: string;
}
```

### システムログ

```typescript
interface SystemLog {
  id: string;
  timestamp: Date;
  level: "info" | "warn" | "error" | "debug";
  component: string;
  message: string;
  details: Record<string, any>;
  correlationId?: string;
  stackTrace?: string;
}
```

### レポート定義

```typescript
interface Report {
  id: string;
  name: string;
  type: "usage" | "security" | "compliance" | "performance" | "custom";
  description: string;
  parameters: ReportParameter[];
  schedule?: {
    frequency: "daily" | "weekly" | "monthly";
    time: string;
    recipients: string[];
  };
  format: "csv" | "pdf" | "excel" | "json";
  createdAt: Date;
  updatedAt: Date;
}
```

## 検索・フィルター機能

### 高度な検索

- 全文検索
- 正規表現対応
- 複数条件組み合わせ
- 保存済み検索条件

### フィルター

- 日付範囲
- ユーザー・部署
- アクション種別
- 結果ステータス
- IP アドレス

## レポート機能

### 定期レポート

- 日次: システム稼働状況
- 週次: セキュリティサマリー
- 月次: 利用状況分析
- 四半期: コンプライアンス報告

### カスタムレポート

- 任意のデータ組み合わせ
- 柔軟な条件設定
- 複数形式出力
- テンプレート機能

## 依存関係

- **前提条件**: TASK-001 (基本プロジェクト構造), TASK-008 (共通コンポーネント), TASK-002 (認証システム)
- **ブロッカー**: なし
- **次のタスク**: なし

## 参考資料

- [Recharts Documentation](https://recharts.org/en-US/)
- [D3.js Documentation](https://d3js.org/)
- [TanStack Table Documentation](https://tanstack.com/table/v8)
- [Elasticsearch Documentation](https://www.elastic.co/guide/)
- docs/DSG-001\_基本設計書.md
- docs/REQ-001\_要求仕様書.md

## 実装ログ

### 2024-12-19

- タスク作成完了
- 要件定義完了
- 画面設計完了

## 完了条件

1. 各種ログが正常に表示される
2. 検索・フィルター機能が動作する
3. レポート生成機能が実装されている
4. データ可視化が正常に動作する
5. エクスポート機能が動作する
